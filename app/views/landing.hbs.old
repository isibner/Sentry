<div id="headerwrap">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 centered">
        <h1><b>Settings</b> for TodoBot</h1>
        <h2>Choose which repos he should help you with.</h2>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row mt centered">
    <div class="col-lg-6 col-lg-offset-3">
      <h1>Your Github Repos</h1>
      <hr>
    </div>
  </div>
  


  {{#each userRepos}}
    <div class="row mt centered">

      <div class="col-sm-3 col-sm-offset-3">
        <h4>{{name}}</h4>
      </div>

      <div class="col-sm-3">
        <button data-repo="{{name}}" data-action="{{addOrRemove}}" class="btn btn-default btn-repo"><i class="fa fa-plus"></i> {{addOrRemoveCaps}}</button>
      </div>
    </div>
  {{/each}}


</div>

<div class="modal fade remove-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
        <h3 class="modal-title" style="color:#333">Are you sure?</h3>
      </div>
      <div class="modal-body">
        <h4 style="color:#333"> This will remove TodoBot from <span class='fillInWithRepo'>placeholder?</span>.</h4>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-warning removeButton">Yes, remove TodoBot.</button>
        <button type="button" class="btn btn-danger removeButton removeIssues">Yes, and remove all of TodoBot's issues too.</button>
      </div>
    </div>
  </div>
</div>


<script type="text/javascript">
  $(document).ready(function(){
    var $removeModal = $('.remove-modal');
    $removeModal.modal({show: false});
    $removeModal.find('.removeButton').on('click', function () {
      var repo = $removeModal.data('targetRepo');
      var removeComments = $(this).hasClass('removeIssues');
      $.ajax({
          type: 'POST',
          url: '/api/removeRepo/' + repo,
          data: {removeComments: removeComments},
          success: function(data) {
            window.location.reload();
          },
          error: function(data) {
            console.log(data);
          }
        });
    });
    $('.btn-repo').on('click', function() {
      var repo = $(this).data('repo');
      var action = $(this).data('action');
      console.log('got click!');

      if (action === 'remove') {
        $removeModal.find('.fillInWithRepo').text(repo);
        $removeModal.modal('show');
        $removeModal.data('targetRepo', repo);
      } else if (action === 'add') {
        $.ajax({
          type: 'POST',
          url: '/api/addRepo/' + repo,
          success: function(data) {
            window.location.reload();
          },
          error: function(data) {
            console.log(data);
          }
        });
      }
    });
  });
</script>